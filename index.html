<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR MenÃ¼ - Modern Restoran Deneyimi</title>
    <link rel="stylesheet" href="style.css">
    <!-- iOS iÃ§in meta etiketleri ekle -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <!-- Model viewer'Ä± mobile-ar sÃ¼rÃ¼mÃ¼ ile deÄŸiÅŸtirelim -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer-usdz-ios-support.js"></script>
    <!-- Temel model viewer kÃ¼tÃ¼phanesi -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-emoji">ğŸ½ï¸</div>
        <div class="spinner"></div>
        <p class="loading-text">AR MenÃ¼ YÃ¼kleniyor...</p>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>

    <!-- Header -->
    <header class="header">
        <h1>âœ¨ AR MenÃ¼</h1>
        <img src="https://placehold.co/120/40" alt="Restaurant Logo" class="logo">
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- AR Instructions -->
        <div class="alert alert-info" id="arInstructions">
            <div class="alert-emoji">ğŸ‘‹</div>
            <div>
                <strong>AR Deneyimi iÃ§in:</strong> Yemek gÃ¶rsellerine tÄ±klayÄ±n ve kameranÄ±zÄ± dÃ¼z bir yÃ¼zeye doÄŸrultun. 
                <a href="#" id="showInstructionsBtn" style="color: var(--primary); font-weight: 600;">DetaylÄ± bilgi</a>
            </div>
        </div>

        <!-- YapÄ±ÅŸkan menÃ¼ sekmeleri - margin ve padding eklendi -->
        <div class="menu-tabs-container">
            <div class="menu-tabs">
                <a href="#mainDishesSection" class="menu-tab active" data-target="mainDishes">
                    <span class="tab-emoji">ğŸ³</span> Ana Yemekler
                </a>
                <a href="#dessertsSection" class="menu-tab" data-target="desserts">
                    <span class="tab-emoji">ğŸ°</span> TatlÄ±lar
                </a>
                <a href="#drinksSection" class="menu-tab" data-target="drinks">
                    <span class="tab-emoji">ğŸ¹</span> Ä°Ã§ecekler
                </a>
                <a href="#popularSection" class="menu-tab" data-target="popular">
                    <span class="tab-emoji">ğŸ”¥</span> PopÃ¼ler
                </a>
            </div>
        </div>

        <!-- AR Container - GeliÅŸtirilmiÅŸ hata mesajlarÄ± -->
        <div class="ar-container" id="arContainer" style="display: none;">
            <canvas id="ar-canvas"></canvas>
            <div id="model-error" style="display: none; color: #ff5a5a; background: rgba(255,255,255,0.9); padding: 15px; border-radius: 8px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; max-width: 80%;">
                <h3 style="margin-bottom: 10px;">Model YÃ¼klenemedi</h3>
                <p>GLB modeli bulunamadÄ± veya yÃ¼klenemedi.</p>
                <p id="model-error-details" style="font-size: 0.8em; margin: 10px 0; color: #666; font-family: monospace; word-break: break-all;"></p>
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee;">
                    <h4 style="margin-bottom: 8px;">Ã‡Ã¶zÃ¼m Ã–nerileri:</h4>
                    <ul style="text-align: left; font-size: 0.9em; padding-left: 20px;">
                        <li>Modelin doÄŸru klasÃ¶rde olduÄŸundan emin olun (models/modelin_adi.glb)</li>
                        <li>Model dosya adÄ±nÄ±n doÄŸru yazÄ±ldÄ±ÄŸÄ±nÄ± kontrol edin</li>
                        <li>Model formatÄ±nÄ±n GLB (kÃ¼Ã§Ã¼k harflerle) olduÄŸunu doÄŸrulayÄ±n</li>
                        <li>TarayÄ±cÄ±nÄ±zÄ± gÃ¼ncelleyin veya farklÄ± bir tarayÄ±cÄ± deneyin</li>
                    </ul>
                </div>
                <button onclick="closeARView()" style="background: var(--primary); color: white; border: none; border-radius: 8px; padding: 8px 16px; margin-top: 15px; cursor: pointer;">Kapat</button>
            </div>
            <div class="controls">
                <button class="control-btn" id="rotateLeftBtn"><i class="fas fa-undo"></i></button>
                <button class="control-btn" id="resetBtn"><i class="fas fa-sync"></i></button>
                <button class="control-btn" id="rotateRightBtn"><i class="fas fa-redo"></i></button>
                <button class="control-btn" id="closeArBtn"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <!-- MenÃ¼ BÃ¶lÃ¼mleri - artÄ±k hepsi gÃ¶rÃ¼nÃ¼r olacak -->
        <section id="mainDishesSection" class="menu-section">
            <h2 class="section-title">ğŸ³ Ana Yemekler</h2>
            <div class="menu-items" id="mainDishes">
                <!-- Menu items will be dynamically populated, showing example format -->
                <div class="menu-item">
                    <img src="/api/placeholder/220/140" alt="KÃ¶fte" class="menu-item-img">
                    <div class="menu-item-info">
                        <div>
                            <span class="food-tag tag-popular">ğŸ”¥ PopÃ¼ler</span>
                        </div>
                        <h3 class="menu-item-title">Izgara KÃ¶fte</h3>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span>4.5</span>
                            <span class="rating-count">(124)</span>
                        </div>
                        <p class="menu-item-price">â‚º80 <span style="font-size: 1.2rem;">ğŸ’°</span></p>
                        <div class="menu-item-ar">
                            <i class="fas fa-cube"></i> AR'da GÃ¶r
                        </div>
                    </div>
                </div>
                
                <div class="menu-item">
                    <img src="/api/placeholder/220/140" alt="Tavuk" class="menu-item-img">
                    <div class="menu-item-info">
                        <div>
                            <span class="food-tag tag-spicy">ğŸŒ¶ï¸ AcÄ±lÄ±</span>
                        </div>
                        <h3 class="menu-item-title">BaharatlÄ± Tavuk</h3>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                            <span>4.0</span>
                            <span class="rating-count">(86)</span>
                        </div>
                        <p class="menu-item-price">â‚º70 <span style="font-size: 1.2rem;">ğŸ’°</span></p>
                        <div class="menu-item-ar">
                            <i class="fas fa-cube"></i> AR'da GÃ¶r
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="dessertsSection" class="menu-section">
            <h2 class="section-title">ğŸ° TatlÄ±lar</h2>
            <div class="menu-items" id="desserts">
                <!-- Example dessert item -->
                <div class="menu-item">
                    <img src="/api/placeholder/220/140" alt="KÃ¼nefe" class="menu-item-img">
                    <div class="menu-item-info">
                        <div>
                            <span class="food-tag tag-popular">ğŸ”¥ PopÃ¼ler</span>
                        </div>
                        <h3 class="menu-item-title">KÃ¼nefe</h3>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span>5.0</span>
                            <span class="rating-count">(210)</span>
                        </div>
                        <p class="menu-item-price">â‚º65 <span style="font-size: 1.2rem;">ğŸ’°</span></p>
                        <div class="menu-item-ar">
                            <i class="fas fa-cube"></i> AR'da GÃ¶r
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="drinksSection" class="menu-section">
            <h2 class="section-title">ğŸ¹ Ä°Ã§ecekler</h2>
            <div class="menu-items" id="drinks">
                <!-- Example drink item -->
                <div class="menu-item">
                    <img src="/api/placeholder/220/140" alt="Ayran" class="menu-item-img">
                    <div class="menu-item-info">
                        <h3 class="menu-item-title">Ayran</h3>
                        <div class="rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="far fa-star"></i>
                            <span>4.2</span>
                            <span class="rating-count">(92)</span>
                        </div>
                        <p class="menu-item-price">â‚º15 <span style="font-size: 1.2rem;">ğŸ’°</span></p>
                        <div class="menu-item-ar">
                            <i class="fas fa-cube"></i> AR'da GÃ¶r
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- PopÃ¼ler BÃ¶lÃ¼mÃ¼ - HTML yapÄ± hatasÄ± dÃ¼zeltildi -->
        <section id="popularSection" class="menu-section">
            <h2 class="section-title">ğŸ”¥ PopÃ¼ler SeÃ§imler</h2>
            <div class="menu-items" id="popularItems">
                <!-- PopÃ¼ler Ã¼rÃ¼nler JavaScript ile doldurulacak -->
            </div>
        </section>
        
        <!-- Call to Action Button -->
        <button class="cta-button">
            <i class="fas fa-utensils"></i> SipariÅŸ Ver
        </button>
    </div>

    <!-- YukarÄ± Ã‡Ä±k Butonu -->
    <div id="backToTop" class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- AR Instructions Modal -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ“± AR NasÄ±l KullanÄ±lÄ±r?</h3>
                <button class="close-modal" id="closeModalBtn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="instruction-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <p>Ä°stediÄŸiniz yemeÄŸin gÃ¶rseline tÄ±klayÄ±n ve "AR'da GÃ¶r" seÃ§eneÄŸini seÃ§in.</p>
                        <img src="https://placehold.co/400x200/eee/999?text=Adim%201" alt="Step 1" class="step-image">
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <p>Kamera izinlerini kabul edin. AR deneyimi iÃ§in kamera eriÅŸimine ihtiyaÃ§ vardÄ±r.</p>
                        <img src="https://placehold.co/400x200/eee/999?text=Adim%202" alt="Step 2" class="step-image">
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <p>KameranÄ±zÄ± dÃ¼z bir yÃ¼zeye doÄŸrultun. Sistem otomatik olarak yÃ¼zeyi algÄ±layacaktÄ±r.</p>
                        <img src="https://placehold.co/400x200/eee/999?text=Adim%203" alt="Step 3" class="step-image">
                    </div>
                </div>
                <div class="instruction-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <p>Ekrana dokunarak 3D modeli yerleÅŸtirin. Modeli dÃ¶ndÃ¼rmek iÃ§in kontrol dÃ¼ÄŸmelerini kullanabilirsiniz.</p>
                        <img src="https://placehold.co/400x200/eee/999?text=Adim%204" alt="Step 4" class="step-image">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AR Troubleshooting Status -->
    <div class="ar-troubleshoot-status" id="arTroubleshootStatus" style="display: none;">
        <div class="ar-status-content">
            <div class="ar-status-title">AR Durum KontrolÃ¼</div>
            <div class="ar-status-message" id="arStatusMessage">Kontrol ediliyor...</div>
            <div class="ar-status-actions">
                <button id="retryARButton">Tekrar Dene</button>
                <button id="closeARStatusButton">Kapat</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    
    <!-- Ana uygulama kodu -->
    <script src="index.js" defer></script>
    
    <!-- Sorun giderme kodu -->
    <script src="troubleshoot.js"></script>
    
    <!-- iOS iÃ§in Ã¶zel AR desteÄŸi kontrolÃ¼ -->
    <script>
        // Safari'de AR Quick Look desteÄŸini test et ve kullanÄ±cÄ±ya bildir
        document.addEventListener('DOMContentLoaded', function() {
            // iOS Safari'de QR desteÄŸi var mÄ± kontrol et
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            
            if (isIOS) {
                // AR Quick Look desteÄŸi var mÄ± kontrol et
                const a = document.createElement('a');
                const hasARSupport = a.relList && a.relList.supports && a.relList.supports('ar');
                
                console.log("iOS AR Quick Look DesteÄŸi:", hasARSupport);
                
                // AR desteÄŸi yok veya Safari deÄŸilse uyarÄ± gÃ¶ster
                if (!hasARSupport || !isSafari) {
                    const arInstructions = document.getElementById('arInstructions');
                    if (arInstructions) {
                        arInstructions.className = 'alert alert-warning';
                        arInstructions.innerHTML = '<div class="alert-emoji">âš ï¸</div><div><strong>AR UyarÄ±:</strong> En iyi AR deneyimi iÃ§in Safari tarayÄ±cÄ±sÄ±nÄ± kullanmanÄ±z Ã¶nerilir.</div>';
                    }
                }
            }
        });
    </script>

    <!-- Dosya yolu doÄŸrulama ve hata ayÄ±klama -->
    <script>
        // Dosya yolunu kontrol etmek iÃ§in Ã¶zel iÅŸlev
        function checkModelExists(url) {
            console.log(`Model kontrolÃ¼: ${url}`);
            
            // GÃ¶reli URL'yi tam URL'ye Ã§evir
            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const absoluteUrl = new URL(url, baseUrl).href;
            
            console.log(`Tam URL: ${absoluteUrl}`);
            
            return fetch(url, { 
                method: 'HEAD',
                cache: 'no-store',
                headers: {
                    'Cache-Control': 'no-cache'
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log(`âœ… Model bulundu: ${url}`);
                    return true;
                } else {
                    console.error(`âŒ Model bulunamadÄ±: ${url} (HTTP ${response.status})`);
                    return false;
                }
            })
            .catch(error => {
                console.error(`âŒ AÄŸ hatasÄ±: ${url}`, error);
                return false;
            });
        }

        // CORS sorunu tespit et
        document.addEventListener('DOMContentLoaded', function() {
            // Sayfa file:// ile mi aÃ§Ä±ldÄ± kontrol et
            if (window.location.protocol === 'file:') {
                console.warn("âš ï¸ SayfayÄ± file:// protokolÃ¼yle aÃ§tÄ±nÄ±z. Bu durum 3D modellerin yÃ¼klenmesini engelleyebilir.");
                console.warn("âš ï¸ Ã‡Ã¶zÃ¼m iÃ§in: Projeyi bir web sunucusu Ã¼zerinde Ã§alÄ±ÅŸtÄ±rÄ±n (Ã¶rn. VS Code Live Server)");
                
                const corsWarning = document.createElement('div');
                corsWarning.style.backgroundColor = '#fff3cd';
                corsWarning.style.color = '#856404';
                corsWarning.style.padding = '15px';
                corsWarning.style.margin = '15px 0';
                corsWarning.style.borderRadius = '8px';
                corsWarning.style.borderLeft = '5px solid #ffeeba';
                corsWarning.innerHTML = `
                    <strong>âš ï¸ 3D Model EriÅŸim Sorunu</strong>
                    <p>TarayÄ±cÄ± dosya eriÅŸim kÄ±sÄ±tlamalarÄ± nedeniyle modeller yÃ¼klenemiyor olabilir.</p>
                    <p><strong>Ã‡Ã¶zÃ¼m:</strong> Projeyi bir web sunucusu Ã¼zerinde Ã§alÄ±ÅŸtÄ±rÄ±n (Ã¶rn. VS Code Live Server).</p>
                `;
                
                // UyarÄ±yÄ± sayfanÄ±n Ã¼st kÄ±smÄ±na ekle
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    mainContainer.insertBefore(corsWarning, mainContainer.firstChild);
                }
            }
            
            // Test et: Modeller doÄŸru konumda mÄ±?
            console.log("Model dosya yollarÄ± kontrol ediliyor...");
            const testPaths = [
                './models/kofte.glb',
                'models/kofte.glb',
                '../models/kofte.glb',
                './assets/models/kofte.glb'
            ];
            
            Promise.all(testPaths.map(checkModelExists)).then(results => {
                const workingPaths = testPaths.filter((_, i) => results[i]);
                if (workingPaths.length > 0) {
                    console.log("âœ… Ã‡alÄ±ÅŸan model yollarÄ±:", workingPaths);
                } else {
                    console.error("âŒ HiÃ§bir model yolu Ã§alÄ±ÅŸmÄ±yor. LÃ¼tfen models klasÃ¶rÃ¼nÃ¼zÃ¼ kontrol edin.");
                }
            });
        });
    </script>

    <!-- Model yÃ¼kleme hatalarÄ±nÄ± gÃ¶stermek iÃ§in eklenen script -->
    <script>
        // GLB modelleri yÃ¼klenemediÄŸinde gÃ¶sterilecek hata iÅŸleyicisi
        document.addEventListener('DOMContentLoaded', function() {
            // model-viewer hatalarÄ±nÄ± takip et
            document.body.addEventListener('error', function(event) {
                const target = event.target;
                if (target.tagName === 'MODEL-VIEWER') {
                    console.error('Model-viewer hatasÄ±:', event);
                    document.getElementById('model-error').style.display = 'block';
                    
                    // Model hatasÄ±nÄ±n detaylarÄ±nÄ± gÃ¶ster
                    const modelErrorDetails = document.getElementById('model-error-details');
                    if (modelErrorDetails) {
                        const src = target.getAttribute('src');
                        modelErrorDetails.textContent = `YÃ¼klenemedi: ${src || 'belirtilmemiÅŸ yol'}`;
                    }
                }
            }, true);
        });
    </script>

    <!-- YukarÄ± Ã§Ä±kma butonu - script etiketi dÃ¼zeltildi -->
    <script>
        // createBackToTopButton fonksiyonu eksikse tanÄ±mlayalÄ±m
        if (typeof createBackToTopButton !== 'function') {
            function createBackToTopButton() {
                const backToTopButton = document.getElementById('backToTop');
                if (backToTopButton) {
                    // Buton zaten var, sadece event listener ekleyelim
                    backToTopButton.addEventListener('click', () => {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                } else {
                    // Buton yoksa oluÅŸtur ve ekle
                    const newButton = document.createElement('div');
                    newButton.id = 'backToTop';
                    newButton.className = 'back-to-top';
                    newButton.innerHTML = '<i class="fas fa-arrow-up"></i>';
                    newButton.addEventListener('click', () => {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                    document.body.appendChild(newButton);
                }
                
                // Scroll event listener'Ä± kontrol et ve ekle
                const handleScrollExists = window.addEventListener('scroll', () => {
                    const btn = document.getElementById('backToTop');
                    if (btn) {
                        if (window.scrollY > 300) {
                            btn.classList.add('visible');
                        } else {
                            btn.classList.remove('visible');
                        }
                    }
                });
            }
            
            // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
            document.addEventListener('DOMContentLoaded', createBackToTopButton);
        }
    </script>
</body>
</html>